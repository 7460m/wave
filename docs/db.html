<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.4" />
<title>h2o_q.db API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
<link href="https://rsms.me/inter/inter-ui.css" rel="stylesheet">
<style>
body {
font-family: 'Inter', sans-serif;
font-size: 1rem;
color: #000;
-webkit-font-smoothing: antialiased;
line-height: 1.666666;
}
img {
max-width: 100%;
}
h1, h2, h3, h4, h5, h6, b, strong {
font-weight: 600;
}
h1, h2, h3, h4, h5, h6 {
font-size: 1rem;
line-height: 1.5;
}
h1 {
margin: 3rem 0 2rem 0;
border-top: 1px solid #000;
}
a {
text-decoration: none;
color: inherit;
border-color: #000;
border-bottom-style: solid;
border-bottom-width: 1px;
}
code {
font-family: 'Inconsolata', monospace;
}
pre {
border: none;
}
dd {
margin-left: 1em;
}
.http-server-breadcrumbs {
font-size: 100%;
}
#sidebar h1, #index h3, #index a, .toc a {
border: none;
}
.desc h2 {
font-size: 1rem;
font-weight: 600;
}
.name {
font-size:1em;
}
.hljs-comment {
font-style: normal;
}
.logo {
border: 10px solid #ffdf00;
height: 110px;
}
</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>h2o_q.db</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from typing import Tuple, List, Optional, Dict

import requests

from .core import marshal, unmarshal


def _new_stmt(query: str, params: List) -&gt; Dict:
    if not isinstance(query, str):
        raise ValueError(f&#39;query must be str; got {type(query)}&#39;)
    for param in params:
        if param is not None and not isinstance(param, (int, float, str)):
            raise ValueError(f&#39;SQL parameter must be one of int, float, str or None; got {type(param)}&#39;)
    return dict(query=query, params=None if len(params) == 0 else params)


def _new_exec_request(database: str, statements: List[Dict], atomic: bool) -&gt; Dict:
    if not isinstance(database, str):
        raise ValueError(f&#39;database must be str; got {type(database)}&#39;)
    return dict(database=database, statements=statements, atomic=atomic)


def _new_db_request(exec: Optional[Dict] = None) -&gt; Dict:
    return dict(exec=exec)


class TeleDBError(Exception):
    &#34;&#34;&#34;
    Represents a remote exception thrown by the TeleDB database server.
    &#34;&#34;&#34;
    pass


class TeleDB:
    &#34;&#34;&#34;
    Represents a TeleDB database client.
    &#34;&#34;&#34;

    def __init__(self, address: str, key_id: str, key_secret: str):
        &#34;&#34;&#34;
        Create a new client instance.

        Args:
            address: database address
            key_id: access key id
            key_secret: access key secret
        &#34;&#34;&#34;
        self._address = address
        session = requests.Session()
        session.headers.update({&#39;Content-type&#39;: &#39;application/json&#39;})
        session.auth = (key_id, key_secret)
        self._session = session

    def __getitem__(self, name: str):
        &#34;&#34;&#34;
        Returns a connector to a database with the given name.

        Args:
            name: the database name
        Returns:
            a connector instance
        &#34;&#34;&#34;
        return _DB(self, name)

    def _call(self, req: dict) -&gt; dict:
        data = marshal(req)
        res = self._session.post(self._address, data=data)
        if res.status_code != 200:
            raise TeleDBError(f&#39;Request failed (code={res.status_code}): {res.text}&#39;)
        return unmarshal(res.text)


class _DB:
    &#34;&#34;&#34;
    Represents a database connector.
    &#34;&#34;&#34;

    def __init__(self, db: TeleDB, name: str):
        self._db = db
        self._name = name

    def exec(self, sql: str, *params) -&gt; Tuple[Optional[List[List]], Optional[str]]:
        &#34;&#34;&#34;
        Execute a single SQL statement. Parameters are optional.

        Returns a (result, error) tuple, where result is a 2-dimensional list in
        row-major order, and error is a string error message, if any.
        The result will be None if the error is not None.
        Therefore, always check if there is an error before attempting to use the result.

        Args:
            sql: SQL statement
            params: Parameters to the SQL statement, one of str, int, float or None
        Returns:
            A (result, error) tuple

        Example:

        result, err = db.exec(sql)
        if err:
            print(error)
            return
        print(result)

        result, error = db.exec(&#39;CREATE TABLE student(name TEXT, age INTEGER)&#39;)
        result, error = db.exec(&#39;INSERT INTO student VALUES (&#34;Alice&#34;, 18)&#39;)
        result, error = db.exec(&#39;INSERT INTO student VALUES (?, ?)&#39;, &#34;Bob&#34;, 19)
        result, error = db.exec(&#39;SELECT name, age FROM student WHERE age &gt; 17&#39;)
        result, error = db.exec(&#39;SELECT name, age FROM student WHERE age &gt; ?&#39;, 17)
        &#34;&#34;&#34;
        r, err = self._exec([(sql, *params)])
        if err:
            return None, err
        return r[0], None

    def exec_many(self, *args) -&gt; Tuple[Optional[List[List[List]]], Optional[str]]:
        &#34;&#34;&#34;
        Execute multiple SQL statements.

        Returns a (results, error) tuple, where results is a list of results from each statement,
        and error is a string error message, if any.
        The results will be None if the error is not None.
        Therefore, always check if there is an error before attempting to use the results.

        Args:
            args: SQL statements
        Returns:
            a (results, error) tuple

        Example:

        results, error = db.exec_many(
            &#39;CREATE TABLE student(name TEXT, age INTEGER)&#39;,
            &#39;INSERT INTO student VALUES (&#34;Alice&#34;, 18)&#39;,
            (&#39;INSERT INTO student VALUES (?, ?)&#39;, &#34;Bob&#34;, 19),
            &#39;SELECT name, age FROM student WHERE age &gt; 17&#39;,
            (&#39;SELECT name, age FROM student WHERE age &gt; ?&#39;, 17),
        )
        if err:
            print(error)
            return
        print(results)

        &#34;&#34;&#34;
        return self._exec(list(args))

    def exec_atomic(self, *args) -&gt; Tuple[Optional[List[List[List]]], Optional[str]]:
        &#34;&#34;&#34;
        Same as exec_may(), but use a transaction. Rollback if any statement fails.
        &#34;&#34;&#34;
        return self._exec(list(args), atomic=True)

    def _exec(self, args: list, atomic=False) -&gt; Tuple[Optional[List[List[List]]], Optional[str]]:
        if len(args) == 0:
            raise ValueError(&#39;Want at least one SQL query, got none&#39;)

        statements: List[Dict] = []
        for arg in args:
            if isinstance(arg, str):
                arg = [arg]
            elif isinstance(arg, tuple):
                arg = list(arg)
            elif isinstance(arg, list):
                pass
            else:
                raise ValueError(&#39;Want SQL string or statement tuple&#39;)

            if len(arg) == 0:
                raise ValueError(&#39;Want statement, got empty tuple/list&#39;)
            statements.append(_new_stmt(arg[0], arg[1:]))

        req = _new_db_request(exec=_new_exec_request(self._name, statements, atomic))
        res = self._db._call(req)
        result, err = res.get(&#39;result&#39;), res.get(&#39;error&#39;)
        if err:
            return None, err
        return result.get(&#39;results&#39;), None</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="h2o_q.db.TeleDB"><code class="flex name class">
<span>class <span class="ident">TeleDB</span></span>
<span>(</span><span>address: str, key_id: str, key_secret: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Represents a TeleDB database client.</p>
<p>Create a new client instance.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>address</code></strong></dt>
<dd>database address</dd>
<dt><strong><code>key_id</code></strong></dt>
<dd>access key id</dd>
<dt><strong><code>key_secret</code></strong></dt>
<dd>access key secret</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TeleDB:
    &#34;&#34;&#34;
    Represents a TeleDB database client.
    &#34;&#34;&#34;

    def __init__(self, address: str, key_id: str, key_secret: str):
        &#34;&#34;&#34;
        Create a new client instance.

        Args:
            address: database address
            key_id: access key id
            key_secret: access key secret
        &#34;&#34;&#34;
        self._address = address
        session = requests.Session()
        session.headers.update({&#39;Content-type&#39;: &#39;application/json&#39;})
        session.auth = (key_id, key_secret)
        self._session = session

    def __getitem__(self, name: str):
        &#34;&#34;&#34;
        Returns a connector to a database with the given name.

        Args:
            name: the database name
        Returns:
            a connector instance
        &#34;&#34;&#34;
        return _DB(self, name)

    def _call(self, req: dict) -&gt; dict:
        data = marshal(req)
        res = self._session.post(self._address, data=data)
        if res.status_code != 200:
            raise TeleDBError(f&#39;Request failed (code={res.status_code}): {res.text}&#39;)
        return unmarshal(res.text)</code></pre>
</details>
</dd>
<dt id="h2o_q.db.TeleDBError"><code class="flex name class">
<span>class <span class="ident">TeleDBError</span></span>
<span>(</span><span>...)</span>
</code></dt>
<dd>
<div class="desc"><p>Represents a remote exception thrown by the TeleDB database server.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TeleDBError(Exception):
    &#34;&#34;&#34;
    Represents a remote exception thrown by the TeleDB database server.
    &#34;&#34;&#34;
    pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<img class='logo' src='https://h2oai.github.io/qd/q.png'/>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="h2o_q" href="index.html">h2o_q</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="h2o_q.db.TeleDB" href="#h2o_q.db.TeleDB">TeleDB</a></code></h4>
</li>
<li>
<h4><code><a title="h2o_q.db.TeleDBError" href="#h2o_q.db.TeleDBError">TeleDBError</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.4</a>.</p>
</footer>
</body>
</html>